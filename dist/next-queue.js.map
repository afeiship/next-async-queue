{"version":3,"sources":["next-queue.js"],"names":[],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"next-queue.js","sourcesContent":["(function() {\n  var global = global || this || window || Function('return this')();\n  var nx = global.nx || require('@feizheng/next-js-core2');\n  var nxRepeatBy = nx.repeatBy || require('@feizheng/next-repeat-by');\n\n  var STATUS = { load: 1, done: 0 };\n  var MSG_TIPS_PROMISIFY = 'Promisify must be wrapped to a function.';\n  var FUNC = 'function';\n\n  var NxQueue = nx.declare('nx.Queue', {\n    statics: {\n      STATUS: STATUS,\n      run: function(inArray, inArgs) {\n        var queue = new nx.Queue(inArray, inArgs);\n        return new Promise(function(resolve, reject) {\n          queue.start().then(\n            function(res) {\n              if (res.status === STATUS.done) {\n                resolve(res.data);\n              }\n            },\n            function(err) {\n              reject(err);\n            }\n          );\n        });\n      },\n      wrap: function(inArray) {\n        var result = [];\n        for (var i = 0; i < inArray.length; i++) {\n          var fn = inArray[i];\n          if (typeof fn.then === FUNC) {\n            nx.error(MSG_TIPS_PROMISIFY);\n            break;\n          }\n\n          /* prettier-ignore */\n          result.push(\n            (function (index) {\n              return function(next, data, initial) {\n                return inArray[index]().then(function(res) {\n                  next(res, data, initial);\n                });\n              }\n            }(i))\n          );\n        }\n        return result;\n      },\n      repeat: function(inPromisify, inCount) {\n        var items = nxRepeatBy(inPromisify, inCount);\n        return this.wrap(items);\n      }\n    },\n    methods: {\n      init: function(inArray, inArgs) {\n        this._callbacks = inArray || [];\n        this._thenCallback = nx.noop;\n        this._thenErrorCallback = nx.noop;\n        this._initial = inArgs;\n        return this.make();\n      },\n      queue: function(inCallback) {\n        this._callbacks.push(inCallback);\n        return this.make();\n      },\n      dequeue: function(inCallback) {\n        var index = this._callbacks.indexOf(inCallback);\n        this._callbacks.splice(index >>> 0, 1);\n        return this.make();\n      },\n      make: function() {\n        var next,\n          self = this;\n        var length = this._callbacks.length;\n        var iterations = (this._iterations = Array(length));\n        var result = [];\n        var done = function(data) {\n          data && result.push(data);\n          self._thenCallback({ status: STATUS.done, data: result });\n        };\n\n        nx.each(this._callbacks, function(i, callback) {\n          iterations[i] = function(data) {\n            next = iterations[i + 1] || done;\n            callback.call(self, next, data, self._initial);\n            data && result.push(data);\n            self._thenCallback({ status: STATUS.load, data: result });\n          };\n        });\n        return this;\n      },\n      then: function(inCallback, inErrorCallback) {\n        this._thenCallback = inCallback;\n        this._thenErrorCallback = inErrorCallback;\n        return this;\n      },\n      start: function() {\n        this._iterations[0]();\n        return this;\n      }\n    }\n  });\n\n  if (typeof module !== 'undefined' && module.exports) {\n    module.exports = NxQueue;\n  }\n})();\n"]}